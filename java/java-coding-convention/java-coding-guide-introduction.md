# 1. はじめに

- [1. はじめに](#1-はじめに)
  - [1.1. 前提](#11-前提)
  - [1.2. 規約の重要性](#12-規約の重要性)
  - [1.3. コーディングの心得](#13-コーディングの心得)
    - [1.3.1. 見やすさを重視しましょう](#131-見やすさを重視しましょう)
    - [1.3.2. 命名はわかりやすくしましょう](#132-命名はわかりやすくしましょう)
    - [1.3.3. サンプルを鵜呑みにしてはいけません](#133-サンプルを鵜呑みにしてはいけません)
    - [1.3.4. 同じコードを二度書かないようにしましょう](#134-同じコードを二度書かないようにしましょう)
    - [1.3.5. 役割は1つにしましょう](#135-役割は1つにしましょう)
  - [1.4. 指標](#14-指標)
  - [1.5. Javaバージョン](#15-javaバージョン)
  - [1.6. 表記ルール](#16-表記ルール)

本規約はJavaを使用してアプリケーションを開発するプロジェクトにおいて、アプリケーションプログラマーが守るべきルールやよりよいソースコードを書くための指針を解説しています。

ただし、掲載内容および利用に際して発生した問題、それに伴う損害については、株式会社ソルクシーズは一切の責務を負わないものとします。  

掲載している情報は予告なく変更することがございますので、あらかじめご了承下さい。

本規約は、ソルクシーズスタンダードのフォーマッター、Checkstyle、SpotBugsに準拠しています。

一部、[Spring Framework](https://docs.spring.io/spring-framework/docs/current/reference/html/overview.html#overview)を前提とした項目も含まれますが、多くの項目は特定のフレームワークに限らず汎用的に使用できるようにしてあります。

本規約は、次のJavaコーディング規約を参照・抜粋しています。

| 規約名 | 著作者 | URL |
| :-- | :-- | :-- |
| Code Conventions for the Java Programming Language | Sun Microsystems | [http://www.oracle.com/technetwork/java/codeconvtoc-136057.html](http://www.oracle.com/technetwork/java/codeconvtoc-136057.html) |
| Google Java Style （非公式和訳） | Google | [https://kazurof.github.io/GoogleJavaStyle-ja/](https://kazurof.github.io/GoogleJavaStyle-ja/) |
| Feture Enterprise Coding Standards | フューチャー株式会社 |[https://future-architect.github.io/coding-standards/documents/forJava/Javaコーディング規約](https://future-architect.github.io/coding-standards/documents/forJava/Java%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E8%A6%8F%E7%B4%84.html#%E3%81%AF%E3%81%97%E3%82%99%E3%82%81%E3%81%ABe) |
| Nablarchスタイルガイド Javaコーディング規約 | TIS | [https://github.com/nablarch-development-standards/nablarch-style-guide/blob/master/java/java-style-guide.md](https://github.com/nablarch-development-standards/nablarch-style-guide/blob/master/java/java-style-guide.md)

## 1.1. 前提

本規約が対象とするソースコードは、次の3つが実施されていることを前提としています。

- ソースコードフォーマッターでフォーマットしていること
- Checkstyleで機械的に検出できる規約違反は解消していること
- SpotBugsで明らかに問題のあるソースコードや、後々問題が発生しそうなソースコードを排除していること

機械的に対処できることはあらかじめ実施し、本規約ではよりよいソースコードを書くためのガイド、あるいはソースコードレビューの指針となるように作成しました。

ソースコードフォーマッター・チェックスタイル・SpotBugsで実施していることは付録のガイドにて解説しています。

著名な静的解析ツールは他にもSonarQubeがありますが、サーバーへインストールする形式のSonarQubeよりもMavenなどの実行だけでチェックが簡潔するCheckstyleとSpotBugsの方が導入の敷居が低いため、本規約ではCheckstyleとSpotBugsを前提にしています。

そのため、SonarQubeで検知できるものもガイドの対象にしています。
SonarQubeで検知できるものは、`☆`をつけています。
必要に応じて利用してください。

プロジェクトによってはCheckstyle・SpotBugs以外の手段で静的解析をする場合もあるでしょう。
必要に応じて、規約の前提条件をCheckstyle、SpotBugs、SonarQubeやその他の静的解析ツールに読み換えて頂いて構いません。

IDEの[IntelliJ Idea](https://www.jetbrains.com/ja-jp/idea/)では、インテリジェンスにJavaの静的解析を行うことができます。

[静的解析対象一覧](https://pleiades.io/help/idea/list-of-java-inspections.html)

静的解析ツールを導入すると、ソースコードの品質が高まるため、導入を推奨します。

## 1.2. 規約の重要性

標準としての規約を定義し、遵守することの重要性を次に示します。

- ソフトウェアメンテナンスにおける、可読性・保守性・拡張性の向上
- 問題を起こしやすい実装を未然に回避することによる、品質・生産性の向上
- 標準規約を通して得られる一般的な実装知識やノウハウ（＝学習効果）

## 1.3. コーディングの心得

長いプログラムを記述すること（ステップ数）によって生産性が評価されたのは、過去の時代の出来事です。現在は、クラスやメソッドの役割が明確で、ロジックが読みやすく、保守性に優れたプログラムを記述することが評価されます。コーディング規約は、コードの書き方に関する一種のパターンと考えることもでき、コードの保守性を向上させる具体的な方法を示しています。したがって、規約のひとつひとつの意図を理解し、守ることが重要になリます。しかし、保守性に優れたコードを作成するためには、コーディング規約を守ることに加えて、良いコードを記述するための基本的な心構えをしっかり心に留めておく必要があります。以下では、その心得について述べます。

【コーディングの心得5か条】

1. 見やすさを重視しましょう
2. 命名はわかりやすくしましょう
3. サンプルを鵜呑みにしてはいけません
4. 同じコードを二度書かないようにしましょう
5. 役割は1つにしましょう

### 1.3.1. 見やすさを重視しましょう

「良いコード」の基本は、「他の人が読んでもわかりやすいと感じられるコード」。コードの見やすさは、フォーマットはもちろん、ロジックの簡潔さやAPIの常識的な使い方などから生まれます。コーディングにあたっては、常に他の人の視点を意識しながら、見やすさに気を配って記述する必要があります。たとえば、自分で記述したコードであっても、しばらくたってから読み返してみると理解に時間がかかった経験は誰にもあるはずです。

次のような言葉もあります。

>三日たてば自分も他人
>
>（[夢空間への招待状](https://www.hyuki.com/dream/hitonari.html)より）

見やすさを重視することは、他の人のためだけでなく自分のためにもなります。コードを読んでもすぐに理解できないような実装は、再考（リファクタリング）の必要があります。

### 1.3.2. 命名はわかりやすくしましょう

コーディングでは、さまざまな変数やメソッドなどに命名（名前付け）する必要があります。命名とは、本来、その対象の本質を表すような名前を考える作業です。大変難易度の高い作業ですが、一方で適当に行ってもソースコードの動作は変わらないため、人によっては手を抜きがちとなります。しかし、命名の良し悪しは、ソースコードの可読性に非常に大きな影響を及ぼします。たとえば、「C0001」というクラス名があるとします。これでは、何を表すクラスなのかすぐにはわかりません。また、「int p = 5000;」という記述があるとします。プログラマに聞くと、変数名`p`は価格（Price）の略だと言います。それならば略さずに、「int price = 5000;」としたほうが分かりやすいです。「命名はわかりやすく」の背景には、読んで内容が理解できるという意味で、文章のようなプログラミングを行う、という考え方に基づきます。

### 1.3.3. サンプルを鵜呑みにしてはいけません

サンプルコードを活用すること自体は、著作権等を侵害しなければ問題ありません。問題なのは、その内容や背景を理解しないまま、サンプルコードだけを鵜呑みにして、「おまじない」として表面的に適用してしまうことです。コードを「おまじない」ととらえていては、サンプルコードの間違いを気づかないまま適用してしまうこともあります。たとえば、streamのクローズ処理を行っていないサンプルコードであっても、それに気づかいまま自分のコードに適用してしまい、あとで思わぬ障害を引き起こすという可能性があリます。サンプルコードは、そこで説明する内容に絞ったコードが多いため、このような例はよく見られます。また、サンプルコードをそのまま適用した結果、自分が記述すべきコードには必要のないコードが含まれてしまう場合もあります。その場合、コードの可読性を下げる原因となります。自分のソースコードは、自分で深く理解して記述すべきです。

### 1.3.4. 同じコードを二度書かないようにしましょう

ソースコードをコピー＆ペーストしていませんか？コピー＆ペーストしてしまうと、何らかの修正をする際に、すべての個所に同じ修正をすることになります。同じソースコードが現れるようならまとめてひとつにし、外に出して呼び出すような書き方にすべきです。同じコードをまとめる作業は、どちらかといえば、コーディング時よりリファクタリング（ソフトウェアの外部的振る舞いを変更せずに内部構造を改善する作業）で行われることが多いです。しかし、コーディング時からできるだけ気をつけておきましょう。
詳しくは[6.16. 代表的なプログラミング原則](./java-coding-guide-recommendations.md)で説明しています。

### 1.3.5. 役割は1つにしましょう

メソッドの役割が明確で、かつ1つであれば単体テストが行いやすくなります。つまり、ソースコードの「試験性」が高まります。また、役割が1つであれば、あとでソースコードを変更する際に修正箇所がわかりやすいため、障害修正に要する時間が短くなります。つまり、コードの「保守性」があがることになリます。たとえば、「チェックをして実行する」機能を実現するために、`checkAndDo()`メソッドが存在したとします。この場合、このメソッドは`check()`メソッドと`do()`メソッドに分割すべきです。なぜなら、`checkAndDo()`メソッドの`check()`ロジックに誤りがあった場合、`do()`メソッドに書かれる内容まで把握する必要が生じるからです。分割してあれば、`check()`メソッドだけの変更で済みます。このことはクラスの設計にもあてはまります。詳しくは[6.16. 代表的なプログラミング原則](./java-coding-guide-recommendations.md)で説明しています。

## 1.4. 指標

アプリケーション開発時は、ソースコードを書くことより読むことに時間を費やします。
必ずソースコードを読む時間の方が多いため、可読性を向上させたソースコードを実装できれば生産性を向上させることができます。

本規約を書くにあたって、次の3つを指標としました。

- ランタイムエラーよりもコンパイルエラー
- 変更可能な状態を減らす
- 状態の変更箇所を局所化する

ランタイムエラーよりもコンパイルエラーとは、アプリケーションを実際に動かさないと発見できないバグよりも、コンパイル時にエラーとなって発見できるバグの方が素早く修正できます。
ランタイムエラーに頼らず、なるべくコンパイルエラーでバグを発見できるようなコーディングを心がけることで、開発者は安心感をもって開発を進められ、読み手に易しいソースコードを提供できます。

変更可能な状態を減らすとは、変更可能な状態とは、`setter`などのメソッドによって再代入できるフィールドや、`java.lang.StringBuilder`のように値を変更できるクラスで宣言されたフィールドを指します。

```java
//setterで変更できるフィールド（変更可能な状態）
private String mutableState;

public void setMutableState(final String mutableState) {
    this.mutableState = mutableState;
}
```

```java
//フィールドは再代入できないが、値は変更できる（変更可能な状態）
private final StringBuilder mutableState = new StringBuilder();

public void appendHello(final String yourName) {
    //値を変更している
    mutableState.append("Hello ").append(yourName);
}
```

変更可能な状態がある場合、現在の状態がどうなっているか頭の中で覚えながらソースコードを読み進めなくてはいけません。
人それぞれですが、一時的に頭の中で覚えておける情報量はそれほど多くありません。
なるべく変更可能な状態を減らすことで、読み手に負担をかけず保守しやすいソースコードになります。

状態の変更箇所を局所化する：`setter`などで状態を変更することがありますが、状態の変更前後で頭の中で覚えている状態も変更しないといけません。
状態を変更するソースコードをなるべく近い場所にまとめることで、読み手に負担をかけず保守しやすいソースコードになります。

本規約はこの指標に則ったソースコードを書くためにはどのようなことに気を配ればよいのかを意識して作成しました。
本規約を読み進める際も、また実際にソースコードを書く際も、この指標を意識しておくとより効果的でしょう。

## 1.5. Javaバージョン

本規約はJava 17をベースに作成しており、一部の項目では新機能にも言及しています。

本規約はJava 11以降をお使いのプロジェクトでご利用頂けます。

また、Lombokを導入する前提で記載をしています。

## 1.6. 表記ルール

本規約ではJavaのバージョンをJ2SE 5やJava SE 8とは書かずに、単にJava 5やJava 8と記載しています。

規約の解説中にソースコード例を掲載することがあります。
やってはいけない「禁止ソースコード」の例は先頭に`//Bad`と一行コメントの形式で記載しています。
禁止ソースコードとの対比として挙げている、やってもよい・ぜひやるべき「推奨ソースコード」の例は先頭に`//Good`と記載しています。
`//Bad`と`//Good`のどちらも記載されていないソースコード例は、「推奨ソースコード」か、もしくは単なる解説の補助として掲載しています。

ソースコード例の中で、特に見せたい箇所以外は省略する場合があります。
その際は `...` と書いて省略を表しています。

```java
//省略の例
public void someMethod(...) { //引数の記載を省略
    ... //メソッド本体の記載を省略
}
```

また、縦に伸びているソースコード例を省略する場合は `.` を縦に3つ書いて表します。

```java
//中略の例
final String text = message.getText();
.
.
.
return text;
```

本規約ではループインデックスを伴う昔ながらの`for`文を「ノーマル`for`文」と表現しています。

```java
//ノーマルfor文の例
for (int i = 0; i < length; i++) {
    ...
}
```

ソースコード例は本規約、特に「7.推奨事項」で挙げられている規約にしたがっているため、次のような特徴があります。

- フィールドには`private`を付けている
- 変数には可能な限り`final`を付けている

他にもしたがっている規約はありますが、詳細は「7.推奨事項」を参照してください。
なお「禁止ソースコード」の例を示すため、一部のソースコード例では規約にしたがっていないものもあります。
