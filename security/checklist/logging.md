# ログ実装

ログとは、あとから確認できる形で出力しておくものになります。

テキストの形式で出力されるものから、ElasticSearchなどのDBに保存し、検索できるようにするものまでさまざまな形式で保存されます。

ログはセキュリティー要件書7.1.1、7.5.1で記されている通り、エラーメッセージの詳細な内容はエラーログなどに出力し、重要な操作もログに出力するべき対象です。

ログではありませんが、パスワードの変更や新規クライアントからのログインなどが行われた場合、ユーザーに通知がいくような仕組みを検討するとよりセキュリティーが高まります。

ログには、大きく次のような分類が存在します。

ログを設計する上で次のものを考慮してください。

## エラー・警告検出用のログ

ログの目的は、エラーや警告を修正することです。

一般的にログと呼ばれた場合は、このログを指す場合が多いです。

重要なデータ（パスワードやクレジットカードの番号など）を出力する設定にしたまま、本番環境に上げてしまうという事故がしばしば起こっているため、注意しましょう。

## 開発・デバッグ用のログ

ログの目的は、開発時のデバッグを容易にすることです。

エラー・警告検出用のログと同様に、重要なデータを出力する設定にしたまま、本番環境に上げてしまうという事故がしばしば起こっているため、注意しましょう。

そういった状況を回避するために、ログレベルを設定し、コンソールに標準出力することは重要です。

デバッグログやトレースログを活用し、本番環境で出力をしない制御できるようにしましょう。

また、Javaでlombokを使用している場合、toStringで出力内容からフィールド変数を出力せずに除外する実装を容易にできます。

## CPUなどのリソース状態監視下のためのログ

ログの目的は、システムの状態を監視することです。

システムがアイドル時だとしても、常にログを出力します。

DDoS攻撃などを検知する場合に、重要なログになります。

## 操作追跡のためのログ

ログの目的は、ユーザーの操作やDBに対するクエリを追跡するものです。

不正アクセスが起こった場合にトレースできます。

特定の挙動でユーザーに対してフラグを立てて出力を開始し、追跡することもあります。

ログを多く出力するため、注意が必要です。

## 監査のためのログ

ログの目的は、重要な操作を記録するログです。

正確に残すべきログになります。

データの巻き戻しなどのサポートをする場合には、100%の正確性が求められます。

ログが記録できない場合は、処理を継続させないべきです。
